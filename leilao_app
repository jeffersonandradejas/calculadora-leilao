import streamlit as st
import pandas as pd

# ConfiguraÃ§Ã£o da pÃ¡gina
st.set_page_config(page_title="Calculadora de LeilÃ£o", layout="centered")

# Biblioteca de Ã­cones (simples representaÃ§Ãµes visuais)
ICONES = {
    "computador": "ğŸ–¥ï¸",
    "notebook": "ğŸ’»",
    "carro": "ğŸš—",
    "moto": "ğŸï¸",
    "bicicleta": "ğŸš²",
    "impressora": "ğŸ–¨ï¸",
    "servidor": "ğŸ—„ï¸",
    "monitor": "ğŸ–¥ï¸",
    "celular": "ğŸ“±",
    "caminhÃ£o": "ğŸšš",
    "outro": "ğŸ“¦"
}

# HistÃ³rico dos cÃ¡lculos (em sessÃ£o)
if "historico" not in st.session_state:
    st.session_state["historico"] = []

# TÃ­tulo elegante
st.markdown("<h1 style='text-align:center;color:#2E8B57;'>ğŸ›’ Calculadora de LeilÃ£o RFB</h1>", unsafe_allow_html=True)
st.markdown("Preencha os dados abaixo para calcular os encargos sobre o item leiloado:")

# Entradas
nome_item = st.text_input("ğŸ“ Nome do Item").strip().lower()
valor = st.number_input("ğŸ’° Valor Arrematado (R$)", min_value=0.0, step=100.0)
aliquota_icms = st.number_input("ğŸ“„ AlÃ­quota ICMS (%)", min_value=0.0, max_value=100.0, value=18.0)
taxa_arm = st.selectbox("ğŸ¬ Taxa de Armazenagem (%)", [5.0, 7.5])

# FunÃ§Ã£o para buscar o Ã­cone
def obter_icone(nome):
    for chave in ICONES:
        if chave in nome:
            return ICONES[chave]
    return ICONES["outro"]

# CÃ¡lculo e exibiÃ§Ã£o
if st.button("ğŸ” Calcular Valor Total"):
    if valor > 0 and aliquota_icms > 0 and taxa_arm > 0:
        icms = valor * aliquota_icms / (100 - aliquota_icms)
        taxa_armazenagem = valor * taxa_arm / 100
        total = valor + icms + taxa_armazenagem
        icone = obter_icone(nome_item)

        resultado = {
            "Item": nome_item.title(),
            "Ãcone": icone,
            "Valor (R$)": round(valor, 2),
            "ICMS (R$)": round(icms, 2),
            "Armazenagem (R$)": round(taxa_armazenagem, 2),
            "Total (R$)": round(total, 2)
        }

        # Atualiza histÃ³rico
        st.session_state["historico"].append(resultado)

        st.success(f"{icone} Resultado para **{nome_item.title()}**")
        st.write(f"ğŸ“„ ICMS: R$ {icms:.2f}")
        st.write(f"ğŸ¬ Armazenagem: R$ {taxa_armazenagem:.2f}")
        st.write(f"ğŸ’µ Valor Total: **R$ {total:.2f}**")
    else:
        st.warning("Preencha todos os campos corretamente.")

# Exibe histÃ³rico
if st.session_state["historico"]:
    st.markdown("---")
    st.markdown("### ğŸ“Š HistÃ³rico de CÃ¡lculos Realizados")
    df = pd.DataFrame(st.session_state["historico"])
    st.dataframe(df, use_container_width=True)

    # BotÃ£o para exportar o CSV
    csv = df.to_csv(index=False).encode("utf-8")
    st.download_button(
        label="ğŸ“„ Exportar HistÃ³rico para CSV",
        data=csv,
        file_name="calculos_leilao.csv",
        mime="text/csv"
    )
